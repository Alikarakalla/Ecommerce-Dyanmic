@if (!site()) {
  <section class="product-placeholder">
    <div class="product-placeholder__panel">
      <h1>No products yet</h1>
      <p>Launch the setup wizard to add your hero products and generate a tailored storefront.</p>
      @if (isAdmin()) {
        <button type="button" (click)="customize()">Start the wizard</button>
      } @else {
        <p class="product-placeholder__hint">Only admins can customize the storefront.</p>
        <a routerLink="/auth/login" class="product-placeholder__cta">Admin sign in</a>
      }
    </div>
  </section>
} @else if (site(); as siteData) {
  @if (product(); as productData) {
    <div class="product-detail">
      <app-site-navbar [site]="siteData"></app-site-navbar>
      <section class="product-detail__body">
        <div class="product-detail__media">
          <div class="product-detail__image">
            <img [src]="currentImage()" alt="{{ productData.name }}" />
            @if (productData.highlight) {
              <span class="product-detail__badge" [style.background]="accentColor()">{{ productData.highlight }}</span>
            }
            <button
              type="button"
              class="product-detail__favorite"
              [class.product-detail__favorite--active]="isFavorite()"
              (click)="toggleFavorite()"
              aria-label="Toggle {{ productData.name }} favorite"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M12 21s-7.5-4.4-10-9.4C-0.9 5.8 2.2 1.5 6.6 2.1 8.7 2.4 10.3 3.9 12 6c1.7-2.1 3.3-3.6 5.4-3.9 4.4-0.6 7.5 3.7 4.6 9.5-2.5 5-10 9.4-10 9.4z"
                />
              </svg>
            </button>
          </div>
          @if (mediaGallery().length > 1) {
            <div class="product-detail__thumbs">
              @for (image of mediaGallery(); track trackImage($index, image); let i = $index) {
                <button
                  type="button"
                  class="product-detail__thumb"
                  [class.product-detail__thumb--active]="i === activeImage()"
                  (click)="selectImage(i)"
                  aria-label="View alternate image"
                >
                  <img [src]="image" alt="{{ productData.name }} thumbnail" />
                </button>
              }
            </div>
          }
        </div>
        <div class="product-detail__info">
          <a class="product-detail__back" routerLink="/" fragment="featured-products">Back to featured</a>
          <h1>{{ productData.name }}</h1>
          <p class="product-detail__price">${{ productData.price | number: '1.0-0' }}</p>
          <p class="product-detail__description">{{ productData.description }}</p>

          @if (sizeOptions().length) {
            <div class="product-detail__option-group">
              <div class="product-detail__option-head">
                <span>Size</span>
                <span>{{ selectedSize() || 'Select size' }}</span>
              </div>
              <div class="product-detail__options">
                @for (size of sizeOptions(); track size) {
                  <button
                    type="button"
                    class="product-detail__option"
                    [class.product-detail__option--selected]="isSizeSelected(size)"
                    (click)="selectSize(size)"
                  >
                    {{ size }}
                  </button>
                }
              </div>
            </div>
          }

          @if (colorOptions().length) {
            <div class="product-detail__option-group">
              <div class="product-detail__option-head">
                <span>Color</span>
                <span>{{ selectedColor() || 'Select color' }}</span>
              </div>
              <div class="product-detail__options product-detail__options--color">
                @for (color of colorOptions(); track color) {
                  <button
                    type="button"
                    class="product-detail__option"
                    [class.product-detail__option--selected]="isColorSelected(color)"
                    (click)="selectColor(color)"
                  >
                    <span class="product-detail__swatch" [style.background]="color"></span>
                    {{ color }}
                  </button>
                }
              </div>
            </div>
          }

          <div class="product-detail__actions">
            <button
              type="button"
              class="product-detail__add"
              (click)="addToCart()"
              [disabled]="isInCart() || !canAddToCart()"
            >
              {{ isInCart() ? 'In cart' : 'Add to cart' }}
            </button>
            <button
              type="button"
              class="product-detail__favorite-toggle"
              [class.product-detail__favorite-toggle--active]="isFavorite()"
              (click)="toggleFavorite()"
            >
              {{ isFavorite() ? 'Favorited' : 'Add to favorites' }}
            </button>
            @if (isAdmin()) {
              <button type="button" class="product-detail__customize" (click)="customize()">Customize site</button>
            } @else {
              <a routerLink="/auth/login" class="product-detail__customize product-detail__customize--link">Admin sign in</a>
            }
          </div>

          @if (!canAddToCart()) {
            <p class="product-detail__hint">Choose {{ sizeOptions().length && !selectedSize() ? 'a size' : '' }}{{ sizeOptions().length && colorOptions().length ? ' and ' : '' }}{{ colorOptions().length && !selectedColor() ? 'a color' : '' }} to continue.</p>
          }
        </div>
      </section>
      <app-site-footer [site]="siteData"></app-site-footer>
    </div>
  } @else {
    <div class="product-detail">
      <app-site-navbar [site]="siteData"></app-site-navbar>
      <section class="product-missing">
        <h1>Product not found</h1>
        <p>We couldn't find that product. Head back to the catalog or refresh your storefront.</p>
        <div class="product-missing__actions">
          <a routerLink="/" fragment="featured-products">Browse catalog</a>
          @if (isAdmin()) {
            <button type="button" (click)="customize()">Open wizard</button>
          } @else {
            <a routerLink="/auth/login" class="product-placeholder__cta">Admin sign in</a>
          }
        </div>
      </section>
      <app-site-footer [site]="siteData"></app-site-footer>
    </div>
  }
}

